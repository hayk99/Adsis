#AUTORES: Hayk Kocharyan (757715) & Jose Felix Yagüe (755416)

##################
TODAS LAS MAQUINAS
##################
Instalo sudo y añado a user al sudoers
sudo hostnamectl set-hostname debian1
sudo nano /etc/hosts
instalo las net-tools

		################################
				RED INTERNA 1
		################################

################
	DEBIAN1
################
ifconfig -a para identificar redes y adaptadores

modificado interfaces 

red host only
auto enp0s8
iface enp0s8 inet static
	address 192.168.56.2
	netmask 255.255.255.0
	network 192.168.56.0
	broadcast 192.168.56.255

red interna: net1
auto enp0s9
iface enp0s9 inet static
	address 192.168.1.1
	netmask 255.255.255.0
	network 192.168.1.0
	broadcast 192.168.1.255

red interna: net2
aut enp0s10
iface enp0s10 inet static
	address 192.168.2.1
	netmask 255.255.255.0
	network 192.168.2.0
	broadcast 192.168.2.255
	post-up route add -net 192.168.3.0 netmask 255.255.255.0 gw 192.168.2.150
	pre-down route del -net 192.168.3.0 netmask 255.255.255.0 gw 192.168.2.150


################
	DEBIAN2
################
añado adaptador con internal network
desactivo nat (enp0s3) y solo dejo enp0s8 para red interna: net1

auto enp0s8
iface enp0s8 inet static
	address 192.168.1.2
	netmask 255.255.255.0
	network 192.168.1.0
	broadcast 192.168.1.255
	gateway 192.168.1.1
	post-up route add -net 192.168.1.0. netmask 255.255.255.0 gw 192.168.1.1 dev enp0s8
	pre-down route del -net 192.168.1.0. netmask 255.255.255.0 gw 192.168.1.1 dev enp0s8


################
	DEBIAN1
################
fichero /etc/sysctl.conf
#net.ipv4.ip_forward=0 ---> net.ipv4.ip_forward=1

iptables -A FORWARD -i enp0s9 -j ACCEPT
iptables -t nat -A POSTROUTING -s 192.168.58.0/24 -o enp0s3 -j MASQUERADE

################
	DEBIAN2
################
sudo apt-get update 
sudo apt-get isntall apache2


		################################
				RED INTERNA 2
		################################
sudo apt-get install isc-dhcp-server
sudo nano /etc/default/isc-dhcp-server 
	--> INTERFACESv4="" ---> INTERFACESv4="enp0s10"
restringes servicio dhcp a esta red


option domain-name "midominio.com";
option domain-name-servers 10.0.2.3, 193.14.7.9;
default-lease-time 600; 
max-lease-time 7200;
option subnet-mask 255.255.255.0;

subnet 192.168.2.0 netmask 255.255.255.0 {
	range 192.168.2. 192.168.2.5;
	option broadcast-address 192.168.2.255;
	option routers 192.168.2.1;
}

host debian1 {
	hardware ethernet 08:00:27:f9:c6:8d; #mac red
	fixed-address 192.168.2.1;
}

#######################
	DEBIAN 3  Y 4 y 6
#######################
Para las 3 maquina:

desactivamos adaptador de nat y añadimos uno de internal network a la red 2
modificamos fichero interfaces 
	allow-hotplug enp0s8
	iface enp0s8 inet dhcp

################
	DEBIAN1
################
iptables -A FORWARD -i enp0s10 -j ACCEPT
iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -o enp0s3 -j MASQUERADE

#######################
	DEBIAN 3  Y 4 y 6
#######################

ifup enp0s8

tras esto ya podemos instalar sudo y net-tools para su futuro uso

Ademas para debian6:
	Tendremos que modificar el fichero /etc/dhcp/dhcpd.conf y añadir a debian6 con ip estatica

host debian6 {
	hardware ethernet 08:00:27:05:99:28; #mac red
	fixed-address 192.168.2.150;
}

	
		################################
				RED INTERNA 3
		################################
################
	DEBIAN 6
################
auto enp0s9
iface enp0s9 inet static
	address 192.168.3.1
	netmask 255.255.255.0
	broadcast 192.168.3.255
	network 192.168.3.0

activamos forwarding :

fichero /etc/sysctl.conf
 #net.ipv4.ip_forward=0 ---> net.ipv4.ip_forward=1

################
	DEBIAN 5
################
auto enp0s8
iface enp0s8 inet static
	address 192.168.60.2
	netmask 255.255.255.0
	broadcast 192.168.60.255
	network 192.168.60.0
	gateway 192.168.60.1
	post-up route add -net 192.168.60.0. netmask 255.255.255.0 gw 192.168.60.1 dev enp0s8
	pre-down route del -net 192.168.60.0. netmask 255.255.255.0 gw 192.168.60.1 dev enp0s8

ifup enp0s8

como ya configuramos al principio debian 1 ya conoce por donde mandar los paqueetes correspondientes a debian 5 y 6


################
	DEBIAN 6
################
debe permitir que debian 5 se conecte a internet

iptables -A FORWARD -i enp0s10 -j ACCEPT
iptables -t nat -A POSTROUTING -s 192.168.2.0/24 -o enp0s8 -j MASQUERADE

###############
	DEBIAN 5
################
apt-get install openssh-server
no permitir root como root